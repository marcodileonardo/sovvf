<div class="modal-header">
  <h4 class="modal-title" style="font-weight: 700">
    <!--{{titolo | uppercase}} -->
    INTERVENTI IN PROSSIMITA' <span class="badge badge-primary ml-2">10</span>
  </h4>
  <button type="button" class="btn btn-light close" style="margin: 2px 2px 0 0; padding: 2px 4px 4px 4px"
          (click)="modal.dismiss('cross')">
    <i class="fa fa-times text-danger"></i>
  </button>
</div>

<div class="modal-body pr-0 lista-richieste-size">
  <!-- SINGOLA RICHIESTA -->
  <div *ngFor="let r of richiesteFake " id="richiesta" class="w-100 rounded card-shadow my-3" style="font-size: 115% !important;">
    <div class="card row_text py-2 px-3"
         (click)="richiestaClick(richiesta)"
         (dblclick)="richiestaDoubleClick(richiesta)"
         (mouseenter)="richiestaHoverIn(richiesta)"
         (mouseleave)="richiestaHoverOut(richiesta)">
      <div class="row align-items-center">
        <div class="col-12">
          <div class="row">
            <div class="col-md-12">
                    <span *ngIf="richiesta?.stato === StatoRichiesta.Sospesa"
                          class="d-inline-block text-danger font-weight-bolder h4"
                          style="position: absolute; left: 0px; top:22px">S</span>
              <!-- PRIMA RIGA -->
              <div class="row">
                <div class="clearfix mx-3">
                  <!-- Priorità -->
                  <i class="guida fa fa-thermometer-half fa-fw font-double-monitor d-none"
                     [class.high-priority]="richiesta.prioritaRichiesta > 3"
                     ngbTooltip="Priorità della richiesta" placement="right"></i>
                  <ngb-rating [(rate)]="richiesta.prioritaRichiesta" [max]="4" [readonly]="true" class="rating-xl">
                    <ng-template let-fill="fill" let-index="index">
                                            <span class="circle font-double-monitor" [class.filled]="fill === 100"
                                                  [class.bad]="index > 2 && fill === 100">
                                                <i class="fa fa-circle mr-1"></i>
                                            </span>
                    </ng-template>
                  </ngb-rating>
                </div>
                <div class="col-3">
                  <ng-template #rilevante>
                    <div *ngIf="richiesta?.rilevanteGrave">
                      Intervento Rilevante
                    </div>
                    <div *ngIf="richiesta?.rilevanteStArCu">
                      Intervento Rilevante Storico Artistico Culturale
                    </div>
                  </ng-template>
                  <div class="h6 mb-1 nowrap font-double-monitor">
                    <i class="guida fa fa-hashtag fa-fw mr-1"
                       ngbTooltip="Identificativo richiesta assistenza" placement="right"></i>
                    <a class="h6 cod-int" (click)="toggleEspanso(richiesta.id)">
                      <span *ngIf="richiesta.codiceRichiesta" class="font-double-monitor">{{ richiesta.codiceRichiesta }} </span>
                      <span *ngIf="!richiesta.codiceRichiesta" class="font-double-monitor">{{ richiesta.codice }} </span>
                    </a>
                    <span *ngIf="richiesta?.rilevanteGrave || richiesta?.rilevanteStArCu"
                          class="d-inline-block mr-1 text-danger"
                          [ngbTooltip]="rilevante" placement="bottom">
                                    <i *ngIf="richiesta?.rilevanteStArCu" class="fa fa-university mr-2"></i>
                                    <i *ngIf="richiesta?.rilevanteGrave" class="fa fa-exclamation"></i>
                                </span>
                  </div>
                </div>
                <div class="clearfix" style="flex: 0 0 54.5% !important;">
                  <!-- descrizione intervento -->
                  <div class="h6 mb-1 nowrap default-cursor font-double-monitor">
                    <div *ngIf="richiesta?.tipologie && richiesta?.tipologie?.length > 0; then thenBlock else elseBlock"></div>
                    <ng-template #thenBlock>
                                    <span>
                                        <i class="fa-fw mr-1 {{ methods.coloraIcona(getPrimaTipologia(richiesta)) }}"
                                           ngbTooltip="{{ richiesta.tipologie[0].descrizione }}"></i>
                                    </span>
                    </ng-template>
                    <ng-template #elseBlock>
                                    <span [ngbPopover]="popTipologie" popoverTitle="Tipologie" triggers="click"
                                          tabindex="0">
                                        <span class="position-relative">
                                            <i class="fa-fw mr-1 {{ methods.coloraIcona(getPrimaTipologia(richiesta)) }}"
                                               ngbTooltip="{{ getDescrizionePrimaTipologia(richiesta) }}"></i>
                                            <span class="badge badge-notify text-light">
                                                {{ richiesta?.tipologie?.length }}
                                            </span>
                                        </span>
                                    </span>
                    </ng-template>
                    <!-- ngbPopover tipologie intervento -->
                    <ng-template #popTipologie>
                      <div class="h6" *ngFor="let t of richiesta?.tipologie">
                        <i class="fa-fw mr-1 {{ methods.coloraIcona(t) }}"></i>&nbsp
                        {{ t?.descrizione }}
                      </div>
                    </ng-template>
                    <span>
                                    <a *ngIf="!!richiesta?.tipologie && richiesta?.tipologie?.length > 0"
                                       class="h6 font-double-monitor descrizione-int"
                                       ngbTooltip="{{ richiesta?.descrizione }}"
                                       [disableTooltip]="richiesta?.descrizione?.length <= 45">
                                        {{ getDescrizionePrimaTipologia(richiesta) | truncate:45 }}
                                    </a>
                                </span>
                  </div>
                </div>
                <div class="col-2 pr-3 text-right">
                  <div class="h6 mb-0">
                    <!-- squadre -->
                    <span class="nowrap">
                                    <ng-container *ngIf="methods.getSquadre(richiesta) as squadre">
                                        <button class="btn btn-light border pl-0 py-0 big_numbers mr-1 font-double-monitor"
                                                [ngbPopover]="popSquadre" container="body" popoverTitle="Squadre"
                                                triggers="click" tabindex="0" style="cursor:pointer; font-size: 115% !important;"
                                                (click)="$event.stopPropagation()">
                                            <i class="guida fa fa-users fa-fw ml-2" ngbTooltip="Numero Squadre"></i>
                                            <span>{{ squadre?.length }}</span>
                                        </button>
                                        <ng-template #popSquadre>
                                            <div class="h6" *ngFor="let s of squadre">
                                                <span>{{ s['nome'] }}</span>
                                                <span> ({{ s['turno'] }})</span>
                                            </div>
                                            <h6 class="mb-0" *ngIf="squadre?.length === 0">Nessuna Squadra</h6>
                                        </ng-template>
                                    </ng-container>
                                </span>

                    <!-- mezzi -->
                    <span class="nowrap">
                                    <button class="btn btn-light border pl-0 py-0 big_numbers font-double-monitor" [ngbPopover]="popMezzi"
                                            popoverTitle="Mezzi" triggers="click" tabindex="0" style="cursor:pointer; font-size: 115% !important;"
                                            (click)="$event.stopPropagation()">
                                        <i class="guida fa fa-truck fa-fw ml-2" ngbTooltip="Numero Mezzi"></i>
                                        <span>{{ methods.numeroMezzi(richiesta) }}</span>
                                    </button>

                                    <ng-template #popMezzi>
                                        <div class="h6 nowrap" *ngFor="let m of methods.mezziRichiesta(richiesta)">
                                            <span>
                                                <span class="badge badge-secondary">{{ m?.stato }}</span>
                                                <span class="font-weight-bold mx-1">{{ m?.descrizione }}</span>
                                                <small>{{ m?.genere }}</small>
                                            </span>
                                        </div>
                                        <h6 class="mb-0" *ngIf="methods.numeroMezzi(richiesta) === 0">
                                            Nessun Mezzo
                                        </h6>
                                    </ng-template>
                                </span>
                  </div>
                </div>
              </div>
              <!-- SECONDA RIGA -->
              <div class="row">
                <div class="clearfix mx-3">

                </div>
                <div class="col-3">
                  <div class="h6 mt-1 mb-2 nowrap default-cursor font-double-monitor">
                    <i class="guida fa fa-clock-o fa-fw mr-1" ngbTooltip="Ricezione richiesta"
                       placement="right" container="body"></i>
                    <a ngbTooltip="{{ (richiesta.istanteRicezioneRichiesta | friendlyDateTooltip) || '' }}">
                                    <span timeago
                                          [date]="methods._dateNumber(richiesta.istanteRicezioneRichiesta)"
                                          [live]="live">
                                    </span>
                    </a>
                  </div>
                </div>
                <div class="clearfix" style="flex: 0 0 54.5% !important;">
                  <!-- richiedente -->
                  <div class="h6 mt-1 mb-2 nowrap default-cursor">
                    <i class="guida fa fa-address-book-o fa-fw mr-1 font-double-monitor" ngbTooltip="Richiedente"
                       container="body"></i>
                    <span *ngIf="richiesta?.richiedente?.nominativo" class="font-double-monitor">
                                    <a ngbTooltip="{{ richiesta?.richiedente?.nominativo }}" placement="right"
                                       [disableTooltip]="richiesta?.richiedente?.nominativo?.length <= 20">
                                        {{ richiesta?.richiedente?.nominativo | truncate:20 }}
                                    </a>
                                </span>
                    <span class="ml-1" class="font-double-monitor">
                                    (
                                        <i class="guida fa fa-phone fa-fw mr-1" ngbTooltip="Numero richiedente"></i>
                                        <a>{{ richiesta?.richiedente?.telefono }}</a>
                                    )
                                </span>
                  </div>
                </div>
                <div class="col-2 pr-3 text-right" [ngClass]="{'mb-1': isEspanso}">
                  <div class="h6 m-0 nowrap my-1">
                    <button *ngIf="!fissata && fissabile" class="btn btn-light border py-0 px-0 mr-1 font-double-monitor"
                            ngbTooltip="Fissa in alto"
                            [disabled]="disableFissaInAlto"
                            (click)="fissaClick(richiesta); $event.stopPropagation()">
                      <i class="fa fa-fw fa-thumb-tack text-secondary"></i>
                    </button>
                    <button *ngIf="fissata && fissabile" class="btn btn-primary py-0 px-0 mr-1 font-double-monitor"
                            ngbTooltip="Inserisci nella lista"
                            (click)="fissaClick(richiesta); $event.stopPropagation()">
                      <i class="fa fa-fw fa-thumb-tack fa-rotate-45"></i>
                    </button>
                    <button *ngIf="listaEventi" class="btn btn-light border py-0 px-1 mr-1 font-double-monitor"
                            ngbTooltip="Elenco eventi"
                            (click)="visualizzaEventiRichiesta(richiesta.codice); $event.stopPropagation()">
                      <i class="fa fa-fw fa-list text-secondary"></i>
                    </button>
                    <button *ngIf="gestibile" class="btn border py-0 px-0 mr-1 font-double-monitor"
                            ngbTooltip="Gestisci"
                            [disabled]="disabledGestisciRichiesta"
                            [ngClass]="{'btn-light': !inGestione, 'btn-secondary': inGestione, 'cursor-not-allowed': disabledGestisciRichiesta}"
                            (click)="onGestioneRichiesta(); $event.stopPropagation()">
                      <i class="fa fa-fw fa-gear"
                         [ngClass]="{'text-secondary': !inGestione, 'text-light': inGestione}"></i>
                    </button>
                  </div>
                </div>
              </div>
              <!-- TERZA RIGA IN SINGLE MONITOR -->
              <div class="row">
                <div class="clearfix mx-3">
                </div>
                <div class="col-3">
                  <i class="guida fa fa-bolt fa-fw mr-1 font-double-monitor" ngbTooltip="Prima assegnazione"
                     placement="right"></i>
                  <span *ngIf="richiesta.stato !== StatoRichiesta.Chiamata" class="font-double-monitor">
                                        <span *ngIf="richiesta.istantePrimaAssegnazione">
                                            {{ richiesta?.istantePrimaAssegnazione | friendlyDateTooltip }}
                                        </span>
                                    </span>

                  <!-- presidiato / non presidiato (1) -->
                  <span *ngIf="richiesta?.stato === StatoRichiesta.Chiamata || !richiesta?.istantePrimaAssegnazione" class="font-double-monitor">
                                        <span class="badge badge-warning text-white">Non Presidiato</span>
                            </span>
                </div>
                <div class="clearfix" style="flex: 0 0 54.5% !important;">
                  <i class="guida fa fa-map-marker fa-fw mr-1 font-double-monitor" ngbTooltip="Località"></i>
                  <span class="font-double-monitor">
                                        <span ngbTooltip="{{ richiesta?.localita?.indirizzo }}" class="font-double-monitor"
                                              [disableTooltip]="richiesta?.localita?.indirizzo?.length <= 30">
                                            {{ richiesta?.localita?.indirizzo | truncate:30 }}
                                        </span>
                                  </span>
                  <span class="list-inline list-unstyled m-0 ml-2 font-double-monitor">
                                        <app-competenza *ngFor="let c of richiesta?.competenze; let i = index"
                                                        [competenza]="c" [i]="i"></app-competenza>
                        </span>
                </div>
                <div class="col-2" [ngClass]="{'mb-1': isEspanso}" style="text-align: right">
                          <span class="h6 m-0 nowrap mt-1">
                            <button *ngIf="espandibile" class="btn border py-0 px-0 mr-1 font-double-monitor"
                                    ngbTooltip="Espandi"
                                    [ngClass]="{'btn-light': !isEspanso, 'btn-secondary': isEspanso}"
                                    (click)="toggleEspanso(richiesta.id); $event.stopPropagation()">
                              <i class="fa fa-fw"
                                 [ngClass]="methods.toggleEspansoClass(isEspanso)"></i>
                            </button>
                            <button *ngIf="modificabile" class="btn btn-light border py-0 px-0 mr-1 font-double-monitor"
                                    ngbTooltip="Modifica"
                                    [disabled]="disabledModificaRichiesta"
                                    [ngClass]="{'cursor-not-allowed': disabledModificaRichiesta}"
                                    (click)="onModificaRichiesta(); $event.stopPropagation()">
                              <i class="fa fa-fw fa-pencil-square-o text-secondary"></i>
                            </button>
                            <button *ngIf="!partenza && composizionePartenza" class="btn btn-light border py-0 px-2 font-double-monitor"
                                    ngbTooltip="Invio partenza"
                                    [disabled]="disabledComposizionePartenza"
                                    [ngClass]="{'cursor-not-allowed': disabledComposizionePartenza}"
                                    (click)="invioPartenza(richiesta); $event.stopPropagation()">
                              <i class="fa fa-fw fa-arrow-right text-secondary"></i>
                            </button>
                            <!-- <button *ngIf="partenza && composizionePartenza"
                                    class="btn btn-primary border py-0 px-2" ngbTooltip="Torna alla lista"
                                    (click)="invioPartenza(richiesta); $event.stopPropagation()">
                                <i class="fa fa-fw fa-arrow-left"></i>
                            </button> -->
                          </span>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
<div class="modal-footer">
  <button class="btn btn-lg btn-secondary text-right" style="font-weight:600" (click)="onCancel()">
    {{ 'Annulla' | uppercase }}
  </button>
  <button class="btn btn-lg btn-danger text-right" style="font-weight:600"
          (click)="onSubmit()">
    {{ 'Conferma' | uppercase }}
  </button>
</div>
